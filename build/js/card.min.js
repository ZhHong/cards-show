"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var GameCard=function(){function e(t){_classCallCheck(this,e);for(var n in t){this[n]=t[n]}this.isDead=false;this.isNew=false}_createClass(e,[{key:"attackP",value:function e(t,n){var r=Math.random();var a=parseInt(this.attack*(r<this.CRI?this.CS:1)*(1-t.defense/(400+t.defense)));var i=t.health-a;notice('<span class="name">'+t.name+"</span>"+"受到"+'<span class="name">'+this.name+"</span>"+'的攻击,造成<span class="num">'+a+"</span>点伤害");t.health=Math.round(i);if(t.health<=0){t.health=0;t.isDead=true;notice('<span class="name">'+t.name+"</span>"+"已经阵亡。")}shake(n,"left");return r<this.CRI?"暴击！":"ok"}}]);return e}();var $cardC=$("#card-container"),$cs=$("li",$cardC);var vm=null,showArr=[],gachaArr=[],attackerArr=[],defenderArr=[],showN=0,s2Vm=null,g0Vm=null,lastSection=$("#section0");var flipCount={count:0,obj:[],canFlip:true};var probability={r:.6,sr:.3,ssr:.1},rArr=[[],[],[]];var $attackers=void 0,$defenders=void 0,defen=[],attac=[];window.onload=init;function init(){$("#section0").style.display="flex";ctxCtrl.init("dot");if(!document.cookie.split("=").some(function(e){return e=="isRead"})){objCtrl.fadeIn($(".dialog-bg")[0]);objCtrl.fadeIn($(".dialog")[0])}initVue();initEvent();initData();setTimeout(function(){objCtrl.fadeOut($(".loader")[0])},500)}function initVue(){vm=new Vue({el:"#card-container",data:{list:showArr},methods:{spread:function e(){if(isSpread)cm.reset();else cm.transform2d(cm.right)}},watch:{list:function e(){setTimeout(function(){$cardC=$("#card-container");$cs=$("li",$cardC);if($cs.length==0)return;objCtrl.addCard($cs[$cs.length-1])},0)}}});s2Vm=new Vue({el:"#s2",data:{list:gachaArr}});g0Vm=new Vue({el:"#game-table-0",data:{aList:attackerArr,dList:defenderArr},watch:{aList:function e(){objCtrl.fadeIn($(".attacker-wrapper")[0]);objCtrl.fadeIn($(".defender-wrapper")[0])}}})}function initEvent(){var e=$("#return-main-nav"),t=$("nav")[0],n=$(".main-nav")[0],r=$("li",n);$(".btn1",$(".dialog")[0])[0].onclick=function(){document.cookie="isRead=true";objCtrl.fadeOut($(".dialog-bg")[0]);objCtrl.fadeOut($(".dialog")[0])};for(var a=0;a<r.length;a++){r[a].index=a}n.addEventListener("click",function(n){if(n.target.nodeName=="A"){for(var a=0;a<r.length;a++){r[a].classList.remove("active")}n.target.parentNode.classList.add("active");statSwitch(n.target.parentNode.index);objCtrl.moveOut(t);objCtrl.fadeIn(e)}});e.onclick=function(){objCtrl.fadeOut(this);objCtrl.moveIn(t)}}function initData(){var e=true;var t=false;var n=undefined;try{for(var r=cardsData[Symbol.iterator](),a;!(e=(a=r.next()).done);e=true){var i=a.value;if(i.rarity.r){rArr[0].push(i)}else if(i.rarity.sr){rArr[1].push(i)}else if(i.rarity.ssr){rArr[2].push(i)}}}catch(e){t=true;n=e}finally{try{if(!e&&r.return){r.return()}}finally{if(t){throw n}}}}function statSwitch(e){switch(e){case 0:objCtrl.fadeOut(lastSection,function(){reset();$("#section0").style.display="flex";lastSection=$("#section0");changeBackground(3,function(){$("#dot").style.background="linear-gradient(to bottom, #9cc2c9, #8468b8)"})});break;case 1:objCtrl.fadeOut(lastSection,function(){reset();$("#section1").style.display="flex";lastSection=$("#section1");changeBackground(0,function(){initS1Event()})});break;case 2:objCtrl.fadeOut(lastSection,function(){reset();$("#section2").style.display="flex";lastSection=$("#section2");changeBackground(1,function(){$("#section2").classList.add("ready");var e=$("img",$(".touch")[0])[1];function t(){$("#section2").classList.add("ready-1");e.removeEventListener(getAnimationend(),t);initS2Event()}e.addEventListener(getAnimationend(),t)})});break;case 3:objCtrl.fadeOut(lastSection,function(){reset();$("#game-table-0").style.display="flex";lastSection=$("#game-table-0");changeBackground(3,function(){initG0Event()})});break;case 4:objCtrl.fadeOut(lastSection,function(){reset();$("#game-table-1").style.display="flex";lastSection=$("#game-table-1");changeBackground(2,function(){flipGame.init()})});break}}var flipGame={MAX_CARD:18,MAX_CARD_LINE:6,_imgArr:[],init:function e(){var t=this;this._setArr();var n=$("#gt");n.innerHTML="";var r=function e(r){setTimeout(function(){var e=document.createElement("li");var a=document.createElement("div");var i=document.createElement("div");a.className="front";a.style.backgroundImage="url(./src/img/game/"+t._imgArr[r]+".png)";i.className="back";e.appendChild(a);e.appendChild(i);e.style.top=Math.floor(r/t.MAX_CARD_LINE)*140+"px";e.style.left=r%t.MAX_CARD_LINE*100+"px";e.gameData=t._imgArr[r];e.isFlip=false;e.onclick=function(){if(!flipCount.canFlip||this.isFlip)return;flipCount.count++;flipCount.obj.push(this);this.classList.add("flipped");e.isFlip=true;if(flipCount.count==2){if(flipCount.obj[0].gameData===flipCount.obj[1].gameData){for(var t=0;t<flipCount.obj.length;t++){flipCount.obj[t].classList.add("right")}flipCount.count=0;flipCount.obj=[]}else{flipCount.canFlip=false;setTimeout(function(){for(var e=0;e<flipCount.obj.length;e++){flipCount.obj[e].classList.remove("flipped");flipCount.obj[e].isFlip=false}flipCount.canFlip=true;flipCount.count=0;flipCount.obj=[]},600)}}};n.appendChild(e);objCtrl.fadeIn($("li",n)[$("li",n).length-1])},100*r)};for(var a=0;a<this.MAX_CARD;a++){r(a)}},_setArr:function e(){this._imgArr=[];var t=this.MAX_CARD/2;for(var n=0;n<t;n++){var r=Math.floor(Math.random()*22+1);if(this._imgArr.indexOf(r)==-1){this._imgArr.push(r)}else{n--}}this._imgArr=this._imgArr.concat(this._imgArr);this._imgArr.sort(function(){return Math.random()-.5});return this._imgArr}};function initS1Event(){var e=$("#click-navigation"),t=$(".addNum",e)[0],n=$(".btn",e)[0];objCtrl.fadeIn(e);for(var r=0;r<17;r++){setTimeout(function(){showArr.push(new GameCard(cardsData[Math.floor(Math.random()*cardsData.length)]))},r*150+600)}n.onclick=function(){var e=parseInt(t.value);if(isNaN(e)){alert("请输入有效数字！")}else if(e>100){alert("输入数字过大！请检查")}else{cm.reset(function(){t.value="";for(var n=0;n<e;n++){setTimeout(function(){showArr.push(new GameCard(cardsData[Math.floor(Math.random()*cardsData.length)]))},n*150+600)}})}}}function initS2Event(){var e=false;gacha(gachaArr,5);var t=$(".book")[0],n=$(".wrapper",$("#s2")),r=$(".shadow",$("#s2"));t.onclick=function(){showN=0;n=$(".wrapper",$("#s2"));r=$(".shadow",$("#s2"));o(n,r);$("#section2").classList.add("gacha");$(".background")[0].children[1].classList.add("brightness");var e=$("img",$(".touch")[0])[1];var t=function t(){$("#s2").style.display="block";$(".touch")[0].style.display="none";e.removeEventListener(getAnimationend(),t);a(showN);document.onclick=function(e){e.preventDefault();showN++;if(showN>=n.length){var t=function(){var e=n[n.length-1];e.classList.remove("show-card");e.classList.add("fade-out-card");e.isShow=false;var t=function t(){e.style.display="";e.classList.remove("fade-out-card");e.removeEventListener(getAnimationend(),t);i();document.onclick=null;showN=0};e.addEventListener(getAnimationend(),t);return{v:void 0}}();if((typeof t==="undefined"?"undefined":_typeof(t))==="object")return t.v}a(showN)}};e.addEventListener(getAnimationend(),t)};function a(t){n[t].isShow=true;e=true;if(t==0){var r=function(){n[t].classList.add("show-card");n[t].style.display="block";var r=function r(){e=false;n[t].removeEventListener(getAnimationend(),r)};n[t].addEventListener(getAnimationend(),r);return{v:void 0}}();if((typeof r==="undefined"?"undefined":_typeof(r))==="object")return r.v}var a=n[t-1];if(a.isShow){(function(){a.classList.remove("show-card");a.classList.add("fade-out-card");a.isShow=false;var r=function r(){a.style.display="";a.classList.remove("fade-out-card");n[t].classList.add("show-card");n[t].style.display="block";var i=function r(){e=false;n[t].removeEventListener(getAnimationend(),r)};n[t].addEventListener(getAnimationend(),i);a.removeEventListener(getAnimationend(),r)};a.addEventListener(getAnimationend(),r)})()}}function i(){var e=function e(t){var r=n[t];r.style.left=-110*(n.length/2-t)+50+"%";setTimeout(function(){objCtrl.fadeIn(r)},100*t)};for(var t=0;t<n.length;t++){e(t)}}function o(t){var n=function n(a){var i=t[a];var o=r[a];i.addEventListener("mouseenter",function(t){if(e)return;t.stopPropagation();var n=function e(t){t.stopPropagation();var n={x:t.clientX-i.getBoundingClientRect().left,y:t.clientY-i.getBoundingClientRect().top};var r=(i.clientWidth/2-n.x)/(i.clientWidth/2)*20;var a=(n.y-i.clientHeight/2)/(i.clientHeight/2)*20;var s=Math.atan2(-(n.x-i.clientWidth/2),-(i.clientHeight/2-n.y));s=s*180/Math.PI;if(r>20)r=20;if(a>20)a=20;i.style.transform="rotateX("+a+"deg) rotateY("+r+"deg) scale3d(1.08, 1.08, 1.08)";o.style.background="linear-gradient("+s+"deg, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0) 80%)"};i.addEventListener("mousemove",n,true);var r=function e(){t.stopPropagation();i.style.transform="none";o.style.background="";i.removeEventListener("mousemove",n);i.removeEventListener("mouseout",e)};i.addEventListener("mouseout",r,true)},true)};for(var a=0;a<t.length;a++){n(a)}}}function initG0Event(){document.onmousedown=function(e){e.preventDefault()};$("#dot").style.background="linear-gradient(to bottom, rgb(167, 228, 239), rgb(245, 159, 167))";attackerArr.splice(0,attackerArr.length);defenderArr.splice(0,defenderArr.length);gacha(attackerArr,3);gacha(defenderArr,3);$attackers=$("li",$(".attacker")[0]);$defenders=$("li",$(".defender")[0]);notice("双击屏幕开始游戏");document.ondblclick=function(){notice("游戏开始");attackerRound(true);document.ondblclick=null}}function changeBackground(e,t){var n=$(".background")[0].children;var r=function t(r){if(r==e)return"continue";var a=n[r];a.className="";setTimeout(function(){a.style.display="none"},1e3)};for(var a=0;a<n.length;a++){var i=r(a);if(i==="continue")continue}n[e].style.display="";setTimeout(function(){n[e].className="showIn";if(typeof t==="function")t()},1e3)}function reset(){var e=$(".wrapper",$("#s2"));showArr.splice(0,showArr.length);$("#section2").className="";$("#gt").innerHTML="";$(".touch")[0].style.display="block";$("#s2").style.display="none";$("#s2").innerHTML="";document.onclick=null;for(var t=0;t<e.length;t++){var n=e[t];e[t].classList.remove("show-card");n.style.display=""}gachaArr.splice(0,gachaArr.length);$(".attacker-wrapper")[0].style.display="";$(".defender-wrapper")[0].style.display="";$(".notice")[0].innerHTML=""}function gacha(e,t){for(var n=0;n<t;n++){var r=Math.random();if(r>=1-probability.r){e.push(new GameCard(rArr[0][Math.floor(Math.random()*rArr[0].length)]))}else if(r>=probability.ssr&&r<probability.sr+probability.ssr){e.push(new GameCard(rArr[1][Math.floor(Math.random()*rArr[1].length)]))}else if(r<probability.ssr){e.push(new GameCard(rArr[2][Math.floor(Math.random()*rArr[2].length)]))}}return e}function attackerRound(e){if(checkDead())return;if(!e){for(var t=0;t<$attackers.length;t++){$attackers[t].onmousedown=null}setTimeout(function(){notice("敌方攻击回合");setTimeout(function(){defenderAi()},500)},500);return}setTimeout(function(){notice("我方攻击回合")},500);var n=false;var r=function e(t){var r=$attackers[t],a=null;r.index=t;r.onmousedown=function(e){if(n)return;if(attackerArr[r.index].isDead){return}e.preventDefault();var t=r.getBoundingClientRect(),i={x:r.offsetLeft,y:r.offsetTop},o={x:e.clientX-t.left-r.offsetLeft,y:e.clientY-t.top-r.offsetTop};r.classList.add("dragging");document.onmousemove=function(e){a=null;var n={x:e.clientX-t.left,y:e.clientY-t.top},i=n.x-o.x,s=n.y-o.y;r.style.left=i+"px";r.style.top=s+"px";for(var c=0;c<$defenders.length;c++){$defenders[c].index=c}for(var l=0;l<$defenders.length;l++){var d=$defenders[l];if(mt.mouseCollisionDetection(e,d)){if(!defenderArr[d.index].isDead){d.classList.add("defense")}}else{d.classList.remove("defense")}}};document.onmouseup=function(e){for(var t=0;t<$defenders.length;t++){var o=$defenders[t];if(mt.mouseCollisionDetection(e,o)){if(!defenderArr[o.index].isDead){a=o}}}if(a){a.classList.remove("defense");attackerArr[r.index].attackP(defenderArr[a.index],a);attackerRound(false);n=true;lMove(r,{left:i.x,top:i.y},300,"easeOut",function(){n=false})}else{n=true;lMove(r,{left:i.x,top:i.y},300,"easeOut",function(){n=false})}r.classList.remove("dragging");document.onmousemove=document.onmouseup=null}}};for(var a=0;a<$attackers.length;a++){r(a)}}function notice(e){var t=$(".notice")[0];var n=document.createElement("li");n.innerHTML=e;t.insertBefore(n,t.children[0]);t.children[0].classList.add("show")}function defenderAi(){var e=Math.floor(Math.random()*defen.length),t=Math.floor(Math.random()*attac.length),n=$defenders[defen[e].index],r=$attackers[attac[t].index],a={x:n.offsetLeft,y:n.offsetTop},i={x:n.getBoundingClientRect().left,y:n.getBoundingClientRect().top},o={x:r.getBoundingClientRect().left,y:r.getBoundingClientRect().top};lMove(n,{top:o.y-i.y+a.y,left:o.x-i.x+a.x},200,"easeIn",function(){defen[e].attackP(attac[t],r);lMove(n,{top:a.y,left:a.x},200,"easeOut");attackerRound(true)})}function checkDead(){attac=[];defen=[];for(var e=0;e<attackerArr.length;e++){var t=attackerArr[e];var n=defenderArr[e];t.index=n.index=e;if(!t.isDead)attac.push(t);if(!n.isDead)defen.push(n)}if(attac.length==0){notice("游戏结束，防守方获胜！");return true}if(defen.length==0){notice("游戏结束，攻击方获胜！");return true}return false}var lastOrigin="50% 90%",isSpread=false;var cm={reset:function e(t){$cardC=$("#card-container");$cs=$("li",$cardC);var n=0;var r=function e(){if(typeof t==="function")t()};if(!isSpread){r();return}var a=function e(t){var a=$cs[t];a.style.transition="500ms";a.style.transform="none";a.style.transformOrigin=lastOrigin;var i=function e(){a.style.transition="none";isSpread=false;a.removeEventListener(getTransitionend(),e);n++;if(n==$cs.length){r()}};a.addEventListener(getTransitionend(),i)};for(var i=0;i<$cs.length;i++){a(i)}return true},transform2d:function e(t){t=t||this.defaultSettings;this.reset(function(){var e=function e(n){var r=$cs[n];var a=Math.floor($cs.length/2);var i=t.center?n<=a?(a-n)*-(t.range/2)/a:(n-a)*(t.range/2)/a:t.range/$cs.length*n+t.range/$cs.length;var o=t.translate||0;if(t.direction=="left"){i=-i;o=-o}o=t.center?n<=a?(a-n)*-(o/2)/a:(n-a)*(o/2)/a:o/$cs.length*n;r.style.transformOrigin=lastOrigin=t.origin.x+"% "+t.origin.y+"%";r.style.transition=t.speed+"ms "+t.easing+" transform";r.style.transform="translate("+o+"px) rotate("+i+"deg)";var s=function e(){r.style.transition="none";isSpread=true;r.removeEventListener(getTransitionend(),e);return r};r.addEventListener(getTransitionend(),s)};for(var n=0;n<$cs.length;n++){e(n)}})},nextCard:function e(){this.reset(function(){var e=$cs[$cs.length-1];e.classList.add("next-animation");var t=function t(){e.classList.remove("next-animation");$cardC.insertBefore(e,$cardC.children[0]);e.removeEventListener(getAnimationend(),t);return e};e.addEventListener(getAnimationend(),t)})},prevCard:function e(){this.reset(function(){var e=$cs[0];e.classList.add("prev-animation");var t=function t(){e.classList.remove("prev-animation");$cardC.appendChild(e);e.removeEventListener(getAnimationend(),t);return e};e.addEventListener(getAnimationend(),t)})},defaultSettings:{speed:500,easing:"ease-out",range:10,translate:300,direction:"right",origin:{x:50,y:90},center:false},right:{speed:500,easing:"ease-out",range:90,direction:"right",origin:{x:50,y:100},center:true,translate:60},left:{speed:500,easing:"ease-out",range:90,direction:"left",origin:{x:50,y:100},center:true,translate:60},horizontalSpread:{speed:500,easing:"ease-out",range:100,direction:"right",origin:{x:50,y:200},center:true},rightSpread:{speed:500,easing:"ease-out",range:20,direction:"right",origin:{x:50,y:200},center:false,translate:300},leftSpread:{speed:500,easing:"ease-out",range:20,direction:"left",origin:{x:50,y:200},center:false,translate:300},rotate360:{speed:500,easing:"ease-out",range:360,direction:"left",origin:{x:50,y:90},center:false},rotate330:{speed:500,easing:"ease-out",range:330,direction:"left",origin:{x:50,y:100},center:true}};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var dots=[],canvas=null,ctx=null,W=null,H=null,options={cW:window.innerWidth,cH:window.innerHeight,numDot:100,radDot:3,dotColor:"rgba(255, 255, 255, .7)",lineDist:70,lineColor:["rgba(255, 255, 255, .4)","rgba(246, 170, 207, .4)","rgba(246, 71, 82, .4)"],vxRange:1,vyRange:1};var Practicle=function(){function e(t,n){_classCallCheck(this,e);this.x=0;this.y=0;this.vx=0;this.vy=0;this.radius=n;this.color=t}_createClass(e,[{key:"draw",value:function e(t){t.save();t.translate(this.x,this.y);t.fillStyle=this.color;t.strokeStyle=this.color;t.beginPath();t.arc(0,0,this.radius,0,Math.PI*2,false);t.closePath();t.fill();t.restore()}},{key:"move",value:function e(){this.x+=this.vx;this.y+=this.vy;if(this.x+this.radius>W){this.x=W-this.radius;this.vx*=-1}else if(this.x-this.radius<0){this.x=this.radius;this.vx*=-1}if(this.y+this.radius>H){this.y=H-this.radius;this.vy*=-1}else if(this.y-this.radius<0){this.y=this.radius;this.vy*=-1}}},{key:"drawLine",value:function e(t){var n=t.x-this.x,r=t.y-this.y,a=Math.sqrt(n*n+r*r);if(a<options.lineDist){ctx.save();ctx.strokeStyle=options.lineColor[1];ctx.beginPath();ctx.moveTo(this.x,this.y);ctx.lineTo(t.x,t.y);ctx.closePath();ctx.stroke();ctx.restore()}}}]);return e}();var ctxCtrl={init:function e(t){canvas=document.getElementById(t);ctx=canvas.getContext("2d");W=options.cW;H=options.cH;canvas.width=options.cW;canvas.height=options.cH;if(!window.requestAnimationFrame){window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,20)}}this.initDots();this.update()},initDots:function e(){for(var t=0;t<options.numDot;t++){var n=new Practicle(options.dotColor,options.radDot);n.x=parseInt(Math.random()*W.toFixed(1));n.y=parseInt(Math.random()*H.toFixed(1));n.vx=Math.random()*options.vxRange;n.vy=Math.random()*options.vyRange;dots.push(n)}},update:function e(){ctx.clearRect(0,0,W,H);dots.forEach(function(e){e.move();e.draw(ctx)});for(var t=0;t<options.numDot-1;t++){var n=dots[t];for(var r=t+1;r<options.numDot;r++){var a=dots[r];n.drawLine(a)}}window.requestAnimationFrame(ctxCtrl.update)}};window.onresize=function(){canvas.width=W=window.innerWidth;canvas.height=H=window.innerHeight};function lMove(e,t,n,r,a){var i={};var o=(new Date).getTime();if(typeof r=="function"){a=r;r="linear"}else{r=r||"linear"}for(var s in t){i[s]={};i[s].startS=parseFloat(getComputedStyle(e)[s]);i[s].move=t[s]-i[s].startS}clearInterval(e.timer);e.timer=setInterval(function(){var t=(new Date).getTime()-o;if(t>=n){t=n}for(var s in i){var c=parseFloat(getComputedStyle(e)[s]);var l=Tween[r](t,i[s].startS,i[s].move,n);if(s=="opacity"){e.style[s]=l}else{e.style[s]=l+"px"}}if(t>=n){clearInterval(e.timer);if(typeof a=="function"){a&&a()}}},20)}var Tween={linear:function(e,t,n,r){return n*e/r+t},easeIn:function(e,t,n,r){return n*(e/=r)*e+t},easeOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t}};